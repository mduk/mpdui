<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <title>Websocket client</title>
    <script src="/static/jquery.min.js"></script>
    <script type="text/javascript">
      
      var websocket;
      $(document).ready(init);
      
      function init() {
          if(!("WebSocket" in window)){  
              $('#status').append('<p><span style="color: red;">websockets are not supported </span></p>');
              $("#navigation").hide();  
          } else {
              $('#status').append('<p><span style="color: green;">websockets are supported </span></p>');
              connect();
          };
              $("#connected").hide(); 	
              $("#content").hide(); 	
      };

      function connect()
      {
          wsHost = $("#server").val()
          websocket = new WebSocket(wsHost);
          
          websocket.onopen = function(evt) { onOpen(evt) }; 
          websocket.onclose = function(evt) { onClose(evt) }; 
          websocket.onmessage = function(evt) { onMessage(evt) }; 
          websocket.onerror = function(evt) { onError(evt) }; 
      };  
      
      function disconnect() {
          websocket.close();
      }; 

      function toggle_connection(){
          if(websocket.readyState == websocket.OPEN){
              disconnect();
          } else {
              connect();
          };
      };

      function send( txt ) {
          if(websocket.readyState == websocket.OPEN){
              websocket.send(txt);
              showScreen('sending: ' + txt); 
          } else {
               showScreen('websocket is not connected'); 
          };
      };

      function sendTxt() {
		send( $("#send_txt").val() );
      };

      function sendCommand( command, arguments ) {
          send( JSON.stringify( {
			cmd: command,
			args: arguments
          } ) );
      };

      function sendSearch() {
		sendCommand( 'search', [
			$("#search_type").val(),
			$("#search_txt").val()
		] );
      };

	function sendPlayid() {
		sendCommand( 'playid', [
			parseInt( $("#playid_txt").val() )
		] );
	};

	function sendSeek() {
		sendCommand( 'seek', [
			parseInt( $("#seek_position_txt").val() ),
			parseInt( $("#seek_time_txt").val() )
		] );
	};

	function sendSeekid() {
		sendCommand( 'seekid', [
			parseInt( $("#seekid_id_txt").val() ),
			parseInt( $("#seekid_time_txt").val() )
		] );
	};

	function sendSeekcur() {
		sendCommand( 'seekcur', [
			parseInt( $("#seekcur_time_txt").val() )
		] );
	};

	function sendDisableoutput() {
		sendCommand( 'disableoutput', [
			parseInt( $("#disableoutput_id_txt").val() )
		] );
	};

      function onOpen(evt) { 
          showScreen('<span style="color: green;">CONNECTED </span>'); 
          $("#connected").fadeIn('slow');
          $("#content").fadeIn('slow');
      };  

      function onClose(evt) { 
          showScreen('<span style="color: red;">DISCONNECTED </span>');
      };  

      function onMessage(evt) { 
          console.log( JSON.parse( evt.data ) );
      };  

      function onError(evt) {
          showScreen('<span style="color: red;">ERROR: ' + evt.data+ '</span>');
      };

      function showScreen(txt) { 
          $('#output').prepend('<p>' + txt + '</p>');
      };

      function clearScreen() 
      { 
          $('#output').html("");
      };
    </script>
  </head>

  <body>
    <div id="header">
      <h1>Websocket client</h1>
      <div id="status"></div>
    </div>


    <div id="navigation">

      <p id="connecting">
		<input type='text' id="server" value="ws://localhost:45001/websocket"></input>
		<button type="button" onclick="toggle_connection()">connection</button>
      </p>
      <div id="connected">				
		<p>
		  <input type='text' id="send_txt"</input>
		  <button type="button" onclick="sendTxt();">send</button>
		</p>
      </div>

		<hr/>

      <div id="mpd-controls-playback">
		<h2>MPD: Current Playlist</h2>
		<button type="button" onclick="sendCommand('previous', []);">&lt;&lt; previous</button>
		<button type="button" onclick="sendCommand('play', []);">play</button>
		<button type="button" onclick="sendCommand('pause', [ 'true' ]);">pause</button>
		<button type="button" onclick="sendCommand('pause', [ 'false' ]);">unpause</button>
		<button type="button" onclick="sendCommand('stop', []);">stop</button>
		<button type="button" onclick="sendCommand('next', []);">next &gt;&gt;</button>

		<br/>

		<input type='text' id="playid_txt" placeholder="id"/>
		<button type="button" onclick="sendPlayid();">playid</button>

		<br/>

		<input type='text' id="seek_position_txt" placeholder="position"/>
		<input type='text' id="seek_time_txt" placeholder="time"/>
		<button type="button" onclick="sendSeek();">seek</button>

		<br/>

		<input type='text' id="seekid_id_txt" placeholder="id"/>
		<input type='text' id="seekid_time_txt" placeholder="time"/>
		<button type="button" onclick="sendSeekid();">seekid</button>

		<br/>

		<input type='text' id="seekcur_time_txt" placeholder="time" disabled="disabled"></input>
		<button type="button" onclick="sendSeekcur();" disabled="disabled">seekcur</button>

      </div>

		<hr/>

      <div id="mpd-controls-currentplaylist">
		<h2>MPD: Playback</h2>
		<button type="button" onclick="sendCommand('playlist', []);">playlist</button>
		<button type="button" onclick="sendCommand('playlistinfo', []);">playlistinfo</button>
		<button type="button" onclick="sendCommand('clear', []);">clear</button>
      </div>

		<hr/>

      <div id="mpd-controls-database">
		<h2>MPD: Database</h2>
		<select id="search_type">
			<option>artist</option>
			<option>title</option>
		</select>
		<input type='text' id="search_txt" value=""/>
		<button type="button" onclick="sendSearch();">search</button>
      </div>

		<hr/>

      <div id="mpd-controls-outputdevices">
		<h2>MPD: Output Device</h2>
		<button type="button" onclick="sendCommand('outputs');">outputs</button>

		<br/>

		<input type='text' id="disableoutput_id_txt" placeholder="id"></input>
		<button type="button" onclick="sendDisableoutput();">disableoutput</button>
      </div>

		<hr/>

      <div id="content">						
		<button id="clear" onclick="clearScreen()" >Clear text</button>
		<div id="output"></div>
      </div>

    </div>
  </body>
</html> 
